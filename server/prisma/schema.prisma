generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum InterestedIn {
  MALE
  FEMALE
  BOTH
}

enum VerificationStatus {
  NONE
  PENDING
  APPROVED
  REJECTED
}

enum UserStatus {
  ACTIVE
  FROZEN       // KullanÄ±cÄ± hesabÄ±nÄ± dondurdu - aynÄ± telefonla tekrar giriÅŸ yapÄ±nca aktifleÅŸir
  SHADOWBANNED
  BANNED
}

enum CardCategory {
  LIFESTYLE
  VALUES
  INTERESTS
  PERSONALITY
  HUMOR
}

enum QuestionCategory {
  RELATIONSHIPS  // Ä°liÅŸkiler
  HOBBIES        // Hobiler
  VALUES         // DeÄŸerler
  LIFESTYLE      // YaÅŸam TarzÄ±
  FUTURE_PLANS   // Gelecek PlanlarÄ±
}

enum QuestionDifficulty {
  EASY
  MEDIUM
  HARD
}

enum ReportCategory {
  SPAM
  HARASSMENT
  FAKE_PROFILE
  INAPPROPRIATE_CONTENT
  OTHER
}

enum ReportStatus {
  PENDING
  REVIEWED
  ACTIONED
}

enum RedeemStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AdminRole {
  SUPER_ADMIN
  MODERATOR
}

enum Platform {
  IOS
  ANDROID
}

enum ChatEndReason {
  CARDS_MISMATCH
  DISCONNECTED
  BLOCKED
  TIMEOUT
  USER_ENDED
}

enum MessageType {
  TEXT
  MEDIA
  TOKEN_GIFT
  SYSTEM
}

model User {
  id                     String        @id @default(uuid())
  
  // ============ AUTH ALANLARI ============
  phoneNumber            String?       @unique  // Telefon ile giriÅŸ (opsiyonel)
  email                  String?       @unique  // E-posta ile giriÅŸ (opsiyonel)
  passwordHash           String?                // E-posta giriÅŸi iÃ§in ÅŸifre hash
  googleId               String?       @unique  // Google OAuth ID
  appleId                String?       @unique  // Apple OAuth ID
  emailVerified          Boolean       @default(false)
  authProvider           String        @default("phone") // phone, email, google, apple
  
  // Refresh Token (session yÃ¶netimi)
  refreshToken           String?
  refreshTokenExp        DateTime?
  
  // ============ ONBOARDING DURUMU ============
  profileComplete        Boolean       @default(false)  // Profil tamamlandÄ± mÄ±?
  onboardingStep         Int           @default(1)      // KaldÄ±ÄŸÄ± onboarding adÄ±mÄ± (1-3)
  frozenAt               DateTime?                       // Hesap ne zaman donduruldu
  
  // ============ PROFÄ°L ALANLARI ============
  nickname               String        @unique
  age                    Int
  birthDate              DateTime?     // DoÄŸum tarihi
  gender                 Gender
  interestedIn           InterestedIn
  bio                    String?       @db.VarChar(150)
  interests              String[]      // Ä°lgi alanlarÄ± tagleri
  city                   String
  country                String        @default("TR")
  latitude               Float?        // Konum - enlem
  longitude              Float?        // Konum - boylam
  avatarId               Int           @default(1)  // 1-8 arasÄ± varsayÄ±lan avatar
  profilePhotoUrl        String?                    // Prime Ã¼yeler iÃ§in Ã¶zel profil fotoÄŸrafÄ±
  profilePhotos          Photo[]
  verificationVideoUrl   String?
  verified               Boolean       @default(false)
  verificationStatus     VerificationStatus @default(NONE)
  isPlus                 Boolean       @default(false)
  plusExpiresAt          DateTime?
  isPrime                Boolean       @default(false)
  primeExpiry            DateTime?
  // Prime filtre ayarlarÄ±
  filterMinAge           Int           @default(18)
  filterMaxAge           Int           @default(99)
  filterMaxDistance      Int           @default(160)  // km cinsinden
  filterGender           String        @default("BOTH") // MALE, FEMALE, BOTH - 50 elmas ile KadÄ±n/Erkek, 30 dk geÃ§erli
  filterGenderActive     Boolean       @default(false)  // Cinsiyet filtresi aktif mi?
  filterGenderExpiresAt  DateTime?                       // KadÄ±n/Erkek tercihi bitiÅŸ (30 dk)
  preferHighSpark        Boolean       @default(false)  // Prime: en yÃ¼ksek sparklÄ± kiÅŸilerle eÅŸleÅŸ (aÃ§/kapa)
  tokenBalance           Int           @default(0)
  monthlyTokensReceived  Int           @default(0)  // Hediye olarak aldÄ±ÄŸÄ± tokenlar
  monthlyTokensEarned    Int           @default(0)  // Hediye olarak kazandÄ±ÄŸÄ± tokenlar
  totalTokensEarned      Int           @default(0)  // Toplam kazanÄ±lan tokenlar (lifetime)
  monthlySparksEarned    Int           @default(0)  // Medya aÃ§Ä±lmasÄ±ndan kazanÄ±lan sparklar (leaderboard iÃ§in)
  totalSparksEarned      Int           @default(0)  // Toplam kazanÄ±lan sparklar (lifetime)
  monthlyResetAt         DateTime      @default(now()) // Son aylÄ±k sÄ±fÄ±rlama tarihi
  
  // ============ GÃœNLÃœK Ã–DÃœL SÄ°STEMÄ° ============
  lastDailyRewardAt      DateTime?                       // Son gÃ¼nlÃ¼k Ã¶dÃ¼l alma zamanÄ±
  currentStreak          Int           @default(0)       // Mevcut ardÄ±ÅŸÄ±k giriÅŸ sayÄ±sÄ±
  longestStreak          Int           @default(0)       // En uzun ardÄ±ÅŸÄ±k giriÅŸ
  
  // ============ BOOST SÄ°STEMÄ° ============
  isBoostActive          Boolean       @default(false)  // Boost aktif mi
  boostExpiresAt         DateTime?                       // Boost bitiÅŸ tarihi
  boostCount             Int           @default(0)       // Toplam kullanÄ±lan boost sayÄ±sÄ±
  
  // ============ Ã–ZEL ETKÄ°NLÄ°K ERÄ°ÅžÄ°MÄ° ============
  hasEventAccess         Boolean       @default(false)  // Ã–zel etkinlik eriÅŸim hakkÄ±
  eventAccessGrantedAt   DateTime?                       // EriÅŸim verilme tarihi
  eventAccessExpiresAt   DateTime?                       // EriÅŸim bitiÅŸ tarihi (opsiyonel)
  dailyChatsStarted      Int           @default(0)   // BugÃ¼n baÅŸlatÄ±lan sohbet sayÄ±sÄ±
  dailyChatsResetAt      DateTime      @default(now()) // GÃ¼nlÃ¼k sÄ±fÄ±rlama tarihi
  status                 UserStatus    @default(ACTIVE)
  reportCount            Int           @default(0)
  positiveRatings        Int           @default(0)  // Ä°yi kullanÄ±cÄ± beÄŸeni sayÄ±sÄ±
  negativeRatings        Int           @default(0)  // BeÄŸenilmeyen kullanÄ±cÄ± sayÄ±sÄ±
  isOnline               Boolean       @default(false)
  lastSeenAt             DateTime?
  expoPushToken          String?
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt

  // Relations
  matchesAsUser1         Match[]       @relation("User1Matches")
  matchesAsUser2         Match[]       @relation("User2Matches")
  matchHistoriesAsUser1  MatchHistory[] @relation("User1MatchHistories")
  matchHistoriesAsUser2  MatchHistory[] @relation("User2MatchHistories")
  messages               Message[]     @relation("UserMessages")
  blocksInitiated        Block[]       @relation("BlocksInitiated")
  blocksReceived         Block[]       @relation("BlocksReceived")
  reportsMade            Report[]      @relation("ReportsMade")
  reportsReceived        Report[]      @relation("ReportsReceived")
  giftsSent              Gift[]        @relation("GiftsSent")
  giftsReceived          Gift[]        @relation("GiftsReceived")
  friendRequestsSent     FriendRequest[] @relation("FriendRequestsSent")
  friendRequestsReceived FriendRequest[] @relation("FriendRequestsReceived")
  friendshipsAsUser1     Friendship[]  @relation("FriendshipUser1")
  friendshipsAsUser2     Friendship[]  @relation("FriendshipUser2")
  verificationVideo       VerificationVideo[]
  friendChatMessagesSent FriendChatMessage[] @relation("SentMessages")
  plusSubscriptions      PlusSubscription[]
  tokenPurchases         TokenPurchase[]
  redeemRequests         RedeemRequest[]
  rewardClaims           RewardClaim[]
  genderFilterPurchases  GenderFilterPurchase[] @relation("GenderFilterPurchases")
  matchQueues            MatchQueue[]           @relation("UserMatchQueues")
  userMatchPreference    UserMatchPreference?   @relation("UserMatchPreference")
  dailyFriendRequestCounts DailyFriendRequestCount[] @relation("DailyFriendRequestCounts")

  // ============ PERFORMANS Ä°NDEKSLERÄ° ============
  @@index([status])                           // Aktif kullanÄ±cÄ± sorgularÄ±
  @@index([gender, interestedIn, status])     // EÅŸleÅŸme algoritmasÄ±
  @@index([isOnline, status])                 // Online kullanÄ±cÄ±lar
  @@index([city, status])                     // Åžehir bazlÄ± arama
  @@index([latitude, longitude])              // Konum bazlÄ± arama
  @@index([tokenBalance])                     // Token sÄ±ralamasÄ±
  @@index([monthlySparksEarned])              // Leaderboard
  @@index([createdAt])                        // Yeni kullanÄ±cÄ±lar
  @@index([lastSeenAt])                       // Son gÃ¶rÃ¼lme
}

enum PhotoType {
  CORE    // KalÄ±cÄ± profil fotoÄŸraflarÄ± (max 6)
  DAILY   // GÃ¼nlÃ¼k fotoÄŸraflar (gÃ¼nde max 3)
}

model Photo {
  id        String    @id @default(uuid())
  userId    String
  url       String
  order     Int
  type      PhotoType @default(CORE)  // core veya daily
  approved  Boolean   @default(false)
  caption   String?   @db.VarChar(80)  // FotoÄŸraf aÃ§Ä±klamasÄ± (max 80 char)
  createdAt DateTime  @default(now())

  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  unlocks   PhotoUnlock[]

  @@index([userId])
  @@index([userId, type])  // Tip bazlÄ± sorgular iÃ§in
  @@index([userId, type, createdAt])  // GÃ¼nlÃ¼k foto sorgularÄ± iÃ§in
}

// FotoÄŸraf aÃ§ma kayÄ±tlarÄ± (hangi kullanÄ±cÄ± hangi fotoÄŸrafÄ± aÃ§tÄ±)
model PhotoUnlock {
  id          String   @id @default(uuid())
  photoId     String
  viewerId    String   // FotoÄŸrafÄ± aÃ§an kullanÄ±cÄ±
  ownerId     String   // FotoÄŸrafÄ±n sahibi
  tokenCost   Int      // Harcanan jeton
  sparkAmount Int      // Sahibine verilen spark
  createdAt   DateTime @default(now())

  photo       Photo    @relation(fields: [photoId], references: [id], onDelete: Cascade)

  @@unique([photoId, viewerId])  // AynÄ± fotoÄŸraf aynÄ± kiÅŸi tarafÄ±ndan bir kez aÃ§Ä±labilir
  @@index([viewerId])
  @@index([ownerId])
}

// Spark iÅŸlem geÃ§miÅŸi (leaderboard ve audit iÃ§in)
model SparkTransaction {
  id          String   @id @default(uuid())
  fromUserId  String   // Spark gÃ¶nderen (fotoÄŸrafÄ± aÃ§an)
  toUserId    String   // Spark alan (fotoÄŸraf sahibi)
  photoId     String?  // Ä°lgili fotoÄŸraf (varsa)
  amount      Int      // Spark miktarÄ±
  reason      String   // 'photo_unlock', 'gift', vb.
  createdAt   DateTime @default(now())

  @@index([fromUserId])
  @@index([toUserId])
  @@index([createdAt])
}

model VerificationVideo {
  id           String   @id @default(uuid())
  userId       String   @unique
  url          String
  thumbnailUrl String?  // ðŸŽ¬ Video thumbnail URL
  createdAt    DateTime @default(now())

  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ============ SELFÄ°E DOÄžRULAMA SÄ°STEMÄ° ============
enum VerificationPose {
  THUMBS_UP          // BaÅŸparmak yukarÄ±
  PEACE_SIGN         // V iÅŸareti
  WAVE_HAND          // El sallama
  POINT_UP           // YukarÄ± iÅŸaret
  OK_SIGN            // OK iÅŸareti
}

model VerificationRequest {
  id              String             @id @default(uuid())
  userId          String
  pose            VerificationPose   // Ä°stenen poz
  selfieUrl       String             // YÃ¼klenen selfie URL
  status          VerificationStatus @default(PENDING)
  reviewedBy      String?            // Admin ID
  reviewNote      String?            // Admin notu (red sebebi vb.)
  reviewedAt      DateTime?
  createdAt       DateTime           @default(now())
  
  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model Card {
  id          String       @id @default(uuid())
  questionTR  String
  category    CardCategory
  optionsJson String       // JSON stringified array of 4 options
  createdAt   DateTime     @default(now())
}

// ============ YENÄ° SORU SÄ°STEMÄ° ============

model Question {
  id          String             @id @default(uuid())
  text        String             // Soru metni
  category    QuestionCategory
  difficulty  QuestionDifficulty @default(MEDIUM)
  usageCount  Int                @default(0)  // KaÃ§ kez soruldu
  isActive    Boolean            @default(true)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  answers     Answer[]
  userAnswers UserAnswer[]

  @@index([category])
  @@index([usageCount])
  @@index([isActive])
}

model Answer {
  id              String   @id @default(uuid())
  questionId      String
  text            String   // Cevap metni
  value           Int      // 1-4 arasÄ± deÄŸer (A=1, B=2, C=3, D=4)
  personalityTrait String? // Opsiyonel: ROMANTIC, ADVENTUROUS, HOMEBODY vb.
  createdAt       DateTime @default(now())

  question        Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  userAnswers     UserAnswer[]

  @@index([questionId])
}

model UserAnswer {
  id          String   @id @default(uuid())
  userId      String
  questionId  String
  answerId    String
  matchId     String   // Hangi match iÃ§in cevaplandÄ±
  createdAt   DateTime @default(now())

  question    Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  answer      Answer   @relation(fields: [answerId], references: [id], onDelete: Cascade)

  @@unique([userId, questionId, matchId])  // AynÄ± matchte aynÄ± soruya 1 cevap
  @@index([userId])
  @@index([matchId])
  @@index([questionId])
}

// Match kartlarÄ± iÃ§in oyun durumu (real-time sync iÃ§in)
model MatchCardGame {
  id              String   @id @default(uuid())
  matchId         String   @unique
  user1Id         String
  user2Id         String
  questionIds     String[] // 5 soru ID'si
  user1Progress   Int      @default(0)  // 0-5 arasÄ±
  user2Progress   Int      @default(0)  // 0-5 arasÄ±
  user1Completed  Boolean  @default(false)
  user2Completed  Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  expiresAt       DateTime // Timeout iÃ§in

  @@index([matchId])
  @@index([user1Id])
  @@index([user2Id])
}

model Match {
  id           String      @id @default(uuid())
  user1Id      String
  user2Id      String
  createdAt    DateTime    @default(now())
  chatUnlocked Boolean     @default(false)
  endedAt      DateTime?
  endReason    ChatEndReason?

  user1        User        @relation("User1Matches", fields: [user1Id], references: [id], onDelete: Cascade)
  user2        User        @relation("User2Matches", fields: [user2Id], references: [id], onDelete: Cascade)
  chatSessions ChatSession[]

  @@index([user1Id])
  @@index([user2Id])
}

model MatchHistory {
  id          String      @id @default(uuid())
  user1Id     String
  user2Id     String
  matchedAt   DateTime    @default(now())
  chatUnlocked Boolean    @default(false)
  endedAt     DateTime?
  endReason   ChatEndReason?

  user1       User        @relation("User1MatchHistories", fields: [user1Id], references: [id], onDelete: Cascade)
  user2       User        @relation("User2MatchHistories", fields: [user2Id], references: [id], onDelete: Cascade)

  @@index([user1Id])
  @@index([user2Id])
  @@index([matchedAt])
}

model ChatSession {
  id                 String      @id @default(uuid())
  matchId            String
  startedAt          DateTime    @default(now())
  currentStage       Int         @default(1)
  stageStartedAt     DateTime    @default(now())
  user1Id            String
  user2Id            String
  user1MessageCount  Int         @default(0)
  user2MessageCount  Int         @default(0)
  endedAt            DateTime?
  endReason          ChatEndReason?

  match              Match       @relation(fields: [matchId], references: [id], onDelete: Cascade)
  messages           Message[]

  @@index([matchId])
}

model Message {
  id            String      @id @default(uuid())
  chatSessionId String
  senderId      String
  content       String?
  mediaUrl      String?
  thumbnailUrl  String?     // ðŸŽ¬ Video thumbnail URL (video iÃ§in)
  mediaType     String?     // 'photo' | 'video' | 'voice'
  messageType   MessageType @default(TEXT)  // TEXT, MEDIA, TOKEN_GIFT, SYSTEM
  tokenAmount   Int?        // TOKEN_GIFT iÃ§in hediye edilen miktar
  locked        Boolean     @default(false) // Medya kilitli mi? (aÃ§mak iÃ§in token gerek)
  isFirstFree   Boolean     @default(false) // Bu gÃ¶nderenin ilk medyasÄ± mÄ±? (Ã¼cretsiz)
  mediaPrice    Int         @default(0)     // AÃ§ma maliyeti (photo:20, video:50, audio:5)
  viewedBy      String?     // GÃ¶rÃ¼ntÃ¼leyen kullanÄ±cÄ± ID
  viewedAt      DateTime?   // GÃ¶rÃ¼ntÃ¼lenme zamanÄ±
  createdAt     DateTime    @default(now())

  chatSession   ChatSession @relation(fields: [chatSessionId], references: [id], onDelete: Cascade)
  sender        User        @relation("UserMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([chatSessionId])
  @@index([senderId])
}

// Medya sayaÃ§ tablosu - "ilk Ã¼cretsiz" mantÄ±ÄŸÄ± iÃ§in
// Mesaj silindikten sonra bile sayaÃ§ korunur
model MediaCounter {
  id            String   @id @default(uuid())
  chatSessionId String
  senderId      String
  receiverId    String
  mediaType     String   // 'photo' | 'video' | 'audio'
  count         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([chatSessionId, senderId, mediaType])
  @@index([chatSessionId])
  @@index([senderId])
}

model Block {
  id             String   @id @default(uuid())
  blockerUserId  String
  blockedUserId  String
  reason         String?
  createdAt      DateTime @default(now())

  blocker        User     @relation("BlocksInitiated", fields: [blockerUserId], references: [id], onDelete: Cascade)
  blocked        User     @relation("BlocksReceived", fields: [blockedUserId], references: [id], onDelete: Cascade)

  @@index([blockerUserId])
  @@index([blockedUserId])
  @@unique([blockerUserId, blockedUserId])
}

model Report {
  id              String         @id @default(uuid())
  reporterUserId  String
  reportedUserId  String
  sessionId       String?
  category        ReportCategory
  description     String?
  screenshot      String?
  status          ReportStatus   @default(PENDING)
  adminNote       String?
  createdAt       DateTime       @default(now())

  reporter        User           @relation("ReportsMade", fields: [reporterUserId], references: [id], onDelete: Cascade)
  reported        User           @relation("ReportsReceived", fields: [reportedUserId], references: [id], onDelete: Cascade)

  @@index([reporterUserId])
  @@index([reportedUserId])
}

model Gift {
  id          String   @id @default(uuid())
  fromUserId  String
  toUserId    String
  sessionId   String?
  amount      Int
  message     String?  @db.VarChar(100)
  createdAt   DateTime @default(now())

  fromUser    User     @relation("GiftsSent", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser      User     @relation("GiftsReceived", fields: [toUserId], references: [id], onDelete: Cascade)

  @@index([fromUserId])
  @@index([toUserId])
}

model FriendRequest {
  id          String   @id @default(uuid())
  fromUserId  String
  toUserId    String
  sessionId   String?
  status      String   @default("PENDING") // PENDING, ACCEPTED, REJECTED
  createdAt   DateTime @default(now())
  respondedAt DateTime?

  fromUser    User     @relation("FriendRequestsSent", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser      User     @relation("FriendRequestsReceived", fields: [toUserId], references: [id], onDelete: Cascade)

  @@index([fromUserId])
  @@index([toUserId])
}

model Friendship {
  id        String   @id @default(uuid())
  user1Id   String
  user2Id   String
  createdAt DateTime @default(now())

  user1     User     @relation("FriendshipUser1", fields: [user1Id], references: [id], onDelete: Cascade)
  user2     User     @relation("FriendshipUser2", fields: [user2Id], references: [id], onDelete: Cascade)
  friendChats FriendChat[]

  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
}

model FriendChat {
  id            String      @id @default(uuid())
  friendshipId  String
  createdAt     DateTime    @default(now())

  friendship    Friendship  @relation(fields: [friendshipId], references: [id], onDelete: Cascade)
  messages      FriendChatMessage[]

  @@index([friendshipId])
}

model FriendChatMessage {
  id           String      @id @default(uuid())
  friendChatId String
  senderId     String
  content      String?
  mediaUrl     String?
  thumbnailUrl String?     // ðŸŽ¬ Video thumbnail URL (video iÃ§in)
  mediaType    String?
  locked       Boolean     @default(false) // Medya kilitli mi?
  isFirstFree  Boolean     @default(false) // Bu gÃ¶nderenin ilk medyasÄ± mÄ±?
  mediaPrice   Int         @default(0)     // AÃ§ma maliyeti
  readAt       DateTime?   // Mesaj okunduÄŸunda set edilir
  createdAt    DateTime    @default(now())

  friendChat   FriendChat  @relation(fields: [friendChatId], references: [id], onDelete: Cascade)
  sender       User        @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([friendChatId])
  @@index([senderId])
}

// ArkadaÅŸ sohbeti medya sayaÃ§ tablosu
model FriendMediaCounter {
  id           String   @id @default(uuid())
  friendChatId String
  senderId     String
  receiverId   String
  mediaType    String   // 'photo' | 'video' | 'audio'
  count        Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([friendChatId, senderId, mediaType])
  @@index([friendChatId])
  @@index([senderId])
}

model PlusSubscription {
  id                     String    @id @default(uuid())
  userId                 String
  productId              String
  platform               Platform
  originalTransactionId  String
  expiresAt              DateTime
  autoRenew              Boolean   @default(true)
  createdAt              DateTime  @default(now())

  user                   User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model TokenPurchase {
  id            String    @id @default(uuid())
  userId        String
  productId     String
  platform      Platform
  receipt       String
  tokensGranted Int
  createdAt     DateTime  @default(now())

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model RedeemRequest {
  id              String       @id @default(uuid())
  userId          String
  requestedAmount Int
  bankAccount     String
  status          RedeemStatus @default(PENDING)
  adminNote       String?
  createdAt       DateTime     @default(now())
  processedAt     DateTime?

  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Admin {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  role         AdminRole @default(MODERATOR)
  createdAt    DateTime  @default(now())
}

model RewardClaim {
  id          String   @id @default(uuid())
  userId      String
  month       DateTime // Ã–dÃ¼l ayÄ±
  rank        Int      // SÄ±ralama (1, 2, 3)
  contactInfo String   // IBAN veya iletiÅŸim bilgisi
  status      String   @default("PENDING") // PENDING, APPROVED, REJECTED, PAID
  adminNote   String?
  createdAt   DateTime @default(now())
  processedAt DateTime?

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([month])
}

// ============ AYLIK LÄ°DERLÄ°K TABLOSU ARÅžÄ°VÄ° ============
model MonthlyLeaderboard {
  id          String   @id @default(uuid())
  userId      String
  month       Int      // 1-12
  year        Int      // 2024, 2025, vb.
  sparkCount  Int      // O ayki spark sayÄ±sÄ±
  rank        Int      // SÄ±ralama
  hasEventAccess Boolean @default(false) // Etkinlik eriÅŸimi kazandÄ± mÄ±
  createdAt   DateTime @default(now())

  @@unique([userId, month, year])  // Her kullanÄ±cÄ± iÃ§in ayda bir kayÄ±t
  @@index([month, year])
  @@index([rank])
}

// ============ YENÄ° EÅžLEÅžME SÄ°STEMÄ° â€“ SORU BANKASI ============
model MatchQuestion {
  id          String   @id @default(uuid())
  questionText String  // Soru metni (TR)
  orderIndex   Int     // 1-5 sÄ±ra
  isActive     Boolean @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  options MatchQuestionOption[]

  @@index([orderIndex])
  @@index([isActive])
}

model MatchQuestionOption {
  id          String   @id @default(uuid())
  questionId  String
  optionText  String   // SeÃ§enek metni
  orderIndex  Int      // 0-3 veya 0-4
  createdAt   DateTime @default(now())

  question    MatchQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([questionId])
}

// ============ YENÄ° EÅžLEÅžME SÄ°STEMÄ° â€“ KUYRUK ============
enum MatchQueueStatus {
  WAITING
  MATCHED
  CANCELLED
}

model MatchQueue {
  id               String           @id @default(uuid())
  userId           String
  enteredAt        DateTime         @default(now())
  priorityScore    Int              @default(0)  // Hesaplanan Ã¶ncelik skoru
  filters          Json?            // { gender, age, distance, minCommon } snapshot
  status           MatchQueueStatus @default(WAITING)
  matchedWithUserId String?         // EÅŸleÅŸince dolu
  matchedAt        DateTime?       // EÅŸleÅŸme zamanÄ±
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  user     User              @relation("UserMatchQueues", fields: [userId], references: [id], onDelete: Cascade)
  answers  MatchQueueAnswer[]

  @@index([userId])
  @@index([status])
  @@index([enteredAt])
  @@index([priorityScore])
  @@index([status, priorityScore])  // 100k: kuyruk taramasÄ± iÃ§in composite
}

model MatchQueueAnswer {
  id           String   @id @default(uuid())
  matchQueueId String
  questionId   String
  optionId     String   // MatchQuestionOption.id
  createdAt    DateTime @default(now())

  matchQueue MatchQueue        @relation(fields: [matchQueueId], references: [id], onDelete: Cascade)

  @@unique([matchQueueId, questionId])  // Her soruya 1 cevap
  @@index([matchQueueId])
  @@index([questionId])
}

// ============ YENÄ° EÅžLEÅžME SÄ°STEMÄ° â€“ KULLANICI TERCÄ°HÄ° ============
model UserMatchPreference {
  id                   String   @id @default(uuid())
  userId               String   @unique
  minimumCommonAnswers Int      @default(1)  // 1-5 arasÄ±
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  user User @relation("UserMatchPreference", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// ============ GÃœNLÃœK ARKADAÅž EKLEME SAYACI ============
model DailyFriendRequestCount {
  id           String   @id @default(uuid())
  userId       String
  date         DateTime @db.Date  // GÃ¼n bazlÄ± (00:00)
  requestCount Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation("DailyFriendRequestCounts", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

// ============ BOOST SATIN ALMA GEÃ‡MÄ°ÅžÄ° ============
model BoostPurchase {
  id            String   @id @default(uuid())
  userId        String
  tokenCost     Int      @default(0) // Eski sistem iÃ§in (artÄ±k kullanÄ±lmÄ±yor)
  priceTL       Float?   // TL cinsinden fiyat (199.90)
  durationHours Int      // Boost sÃ¼resi (saat)
  activatedAt   DateTime @default(now())
  expiresAt     DateTime
  transactionId String?  @unique // App Store / Play Store transaction ID
  purchaseToken String?  // IAP purchase token
  createdAt     DateTime @default(now())

  @@index([userId])
  @@index([activatedAt])
  @@index([transactionId])
}

// ============ CÄ°NSÄ°YET FÄ°LTRESÄ° SATIN ALMA GEÃ‡MÄ°ÅžÄ° ============
model GenderFilterPurchase {
  id            String   @id @default(uuid())
  userId        String
  filterType    String   // 'MALE' | 'FEMALE' (BOTH Ã¼cretsiz)
  tokenCost     Int      // 50 elmas
  durationMinutes Int    // 30 dakika
  activatedAt   DateTime @default(now())
  expiresAt     DateTime
  createdAt     DateTime @default(now())

  user          User     @relation("GenderFilterPurchases", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([activatedAt])
  @@index([expiresAt])
}

